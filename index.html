<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reports Hub</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#121822; --muted:#8aa1b1; --text:#e9f0f6; --accent:#78d3ff;
      --ring: rgba(120,211,255,.35); --card-border: rgba(255,255,255,.08);
      --table-head:#f8fafc; --table-border:#e5e7eb; --table-row:#ffffff; --table-text:#0b1220;
    }
    [data-theme="light"]{
      --bg:#f6f8fa; --card:#ffffff; --muted:#57606a; --text:#0b1220; --accent:#0ea5e9;
      --ring: rgba(14,165,233,.25); --card-border:#e5e7eb;
      --table-head:#f8fafc; --table-border:#e5e7eb; --table-row:#ffffff; --table-text:#0b1220;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, #132034 0%, #0b0f14 60%);
    }
    [data-theme="light"] body{ background:#f6f8fa; }
    .wrap{ max-width:1000px; margin:0 auto; padding:40px 16px; }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--card-border); border-radius:16px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
      backdrop-filter: blur(6px);
    }
    h1{ font-size:28px; margin:0 0 6px; letter-spacing:.2px; }
    p.sub{ color:var(--muted); margin:0 0 18px; }
    .controls{ display:flex; flex-wrap:wrap; gap:10px; margin:14px 0 16px; align-items:center }
    .search{ flex:1; min-width:220px; position:relative; }
    .search input{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--card-border); outline:none;
      background:#0f1520; color:var(--text); box-shadow: 0 0 0 0 var(--ring);
    }
    [data-theme="light"] .search input{ background:#fff; }
    .btn{
      padding:10px 12px; border-radius:10px; border:1px solid var(--card-border); background:#0f1520; color:var(--text); cursor:pointer;
    }
    [data-theme="light"] .btn{ background:#fff; }
    .btn-accent{ background:var(--accent); color:#041018; border-color:transparent; }
    .pill{ display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid var(--card-border); color:var(--muted); font-size:12px; }
    table{ width:100%; border-collapse:separate; border-spacing:0 8px; color:var(--table-text) }
    thead th{ text-align:left; font-weight:600; color:var(--muted); padding:0 12px 6px; }
    tbody tr{ background:var(--card); border:1px solid var(--card-border); }
    tbody td{ padding:12px; vertical-align:middle; }
    tbody tr td:first-child{ border-top-left-radius:12px; border-bottom-left-radius:12px; }
    tbody tr td:last-child{ border-top-right-radius:12px; border-bottom-right-radius:12px; }
    .name a{ color:var(--accent); text-decoration:none; }
    .name small{ color:var(--muted); display:block; margin-top:4px; }
    .empty, .error{ color:var(--muted); padding:10px 0 0; }
    footer{ color:var(--muted); margin-top:16px; font-size:12px; }
    .hide{ display:none !important; }
    .row{ display:flex; gap:10px; align-items:center }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between;margin-bottom:10px">
      <a class="btn btn-accent" href="/reports/viewer.html">âž• Open Viewer / Import Report</a>
      <button id="themeToggle" class="btn" title="Toggle theme">ðŸŒ— Theme</button>
    </div>

    <div class="card">
      <h1>Reports Hub</h1>
      <p class="sub">Browse and search your exported HTML reports. New files added to <code>/exports</code> appear automatically. Use the viewer to import new ones.</p>

      <div class="controls">
        <div class="search"><input id="q" type="search" placeholder="Search reports by nameâ€¦" aria-label="Search reports" /></div>
        <button class="btn" id="sortName">Sort: Name â–²</button>
        <button class="btn" id="sortSize">Sort: Size</button>
        <span class="pill" id="count">0 reports</span>
      </div>

      <div id="status" class="empty">Loading reportsâ€¦</div>

      <table class="hide" id="table" aria-live="polite">
        <thead><tr><th>Report</th><th>Size</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>

      <footer>Tip: name files like <code>2025-08-13_ytd-category-report.html</code> to get nice alphabetical sorting by date.</footer>
    </div>
  </div>

  <script>
    // Config
    const OWNER  = "cameron-spree";
    const REPO   = "reports";
    const FOLDER = "exports";
    const BASE_PATH = "/reports";

    // Theme
    const root = document.documentElement;
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) root.setAttribute("data-theme", savedTheme);
    document.getElementById("themeToggle").onclick = () => {
      const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
      root.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    };

    // Listing
    const apiURL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(FOLDER)}`;
    const $q = document.getElementById("q");
    const $rows = document.getElementById("rows");
    const $table = document.getElementById("table");
    const $status = document.getElementById("status");
    const $count = document.getElementById("count");
    const $sortName = document.getElementById("sortName");
    const $sortSize = document.getElementById("sortSize");
    let items = [], sortMode="nameAsc";

    function fmtBytes(bytes){
      if (bytes === 0) return "0 B";
      const k = 1024, units = ["B","KB","MB","GB","TB"];
      const i = Math.floor(Math.log(bytes)/Math.log(k));
      return parseFloat((bytes/Math.pow(k,i)).toFixed(2)) + " " + units[i];
    }

    function render(){
      const q = ($q.value || "").toLowerCase().trim();
      let filtered = items.filter(it => it.name.toLowerCase().includes(q));
      filtered.sort((a,b) => {
        if (sortMode === "nameAsc") return a.name.localeCompare(b.name, undefined, {numeric:true});
        if (sortMode === "nameDesc") return b.name.localeCompare(a.name, undefined, {numeric:true});
        if (sortMode === "sizeAsc") return (a.size||0) - (b.size||0);
        if (sortMode === "sizeDesc") return (b.size||0) - (a.size||0);
        return 0;
      });

      $rows.innerHTML = "";
      for (const f of filtered){
        const tr = document.createElement("tr");
        const link = document.createElement("a");
        link.href = `${BASE_PATH}/${FOLDER}/${encodeURIComponent(f.name)}`;
        link.textContent = f.name.replace(/_/g, " ");
        link.target = "_blank"; link.rel = "noopener";

        const tdName = document.createElement("td");
        tdName.className = "name";
        tdName.appendChild(link);

        const tdSize = document.createElement("td");
        tdSize.textContent = f.size ? fmtBytes(f.size) : "â€”";

        tr.appendChild(tdName); tr.appendChild(tdSize);
        $rows.appendChild(tr);
      }
      $count.textContent = `${filtered.length} report${filtered.length===1?"":"s"}`;
      $table.classList.toggle("hide", filtered.length===0);
      $status.classList.toggle("hide", filtered.length>0);
      if (filtered.length===0) $status.textContent = q ? "No reports match your search." : "No reports found in the folder.";
    }

    function toggleSort(primary, btn){
      const isName = primary === "name";
      const asc = sortMode !== `${primary}Asc`;
      sortMode = primary + (asc ? "Asc" : "Desc");
      if (isName){ $sortName.textContent = `Sort: Name ${asc ? "â–²" : "â–¼"}`; $sortSize.textContent="Sort: Size"; }
      else { $sortSize.textContent = `Sort: Size ${asc ? "â–²" : "â–¼"}`; $sortName.textContent="Sort: Name"; }
      render();
    }
    $sortName.onclick = () => toggleSort("name");
    $sortSize.onclick = () => toggleSort("size");
    $q.oninput = render;

    (async function load(){
      try{
        const res = await fetch(apiURL, { headers: { "Accept":"application/vnd.github.v3+json" } });
        if (!res.ok) throw new Error(`GitHub API error ${res.status}`);
        const data = await res.json();
        items = (Array.isArray(data)?data:[])
          .filter(it => it.type === "file" && /\.html?$/i.test(it.name))
          .map(it => ({ name: it.name, size: it.size, path: it.path }));
        if (items.length === 0) $status.textContent = "No HTML reports found in the folder yet.";
        else { $status.classList.add("hide"); render(); }
      } catch(e){
        console.error(e);
        $status.className = "error";
        $status.textContent = "Couldnâ€™t load the file list. Check your repo settings.";
      }
    })();
  </script>
</body>
</html>
